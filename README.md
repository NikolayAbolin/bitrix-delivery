# Модуль расчёта доставки Marschroute для 1C-Bitrix

Данный модуль предназначен для выбора типа доставки и расчёта стоимости доставки заказа. Он может быть легко установлен на сайт  1С-Битрикс (версии 12.5.5. и последующих). В нем присутствует: выбор города, блок показа всех типов доставки с указанием адреса и даты доставки, карта с показом всех пунктов вывоза заказа. 

Далее представлена инструкция по установке на сайт 1С-Битрикс.


# 1) Вставка кода и файлов
 
1.1) В разделе Администрирование откройте: [Контент] -> [Структура сайта] -> [Файлы и папки] 
 
1.2) Там создайте папку custom в /bitrix/components и загрузите туда компонент marschroute.widget

1.3) В папке /bitrix/php_interface/include создайте папку sale_delivery, загрузите туда файл delivery_route.php 
 
1.4) Пропишите в конец файла <ваш шаблон>/components/bitrix/sale.order.ajax/myorder/props.php  
(Пример: bitrix/templates/bright/component/bitrix/sale.order.ajax/myorder/props.php, где bright - <ваш шаблон>)  
строку:  

```php 
   <?php  
    $APPLICATION->IncludeComponent("custom:marschroute.widget", ".default", Array('WIDTH' => 1100, 'HEIGHT' => 600, 'ORDER' => $arResult), false);  
    ?>  
```
Где WIDTH - ширина, HEIGHT - высота виджета.

__Примечание:__   
Название и ID шаблона можно найти в: [Настройки] -> [Настройки продукта] -> [Сайты] -> [Список сайтов]  
/bitrix/templates/ - местоположение шаблонов

# 2) Настройка свойств заказа

2.1) В разделе Администрирование откройте: [Магазин] -> [Настройки] -> [Свойства заказа] -> [Список свойств]
  
2.2)  Нажмите кнопку [+ Новое свойство], выберите <Физическое лицо>  

2.3) Заполните 3 поля:  

2.3.1)
- Название: [Маршрут] Стоимость доставки
- Мнемонический код: route_cost
- Тип: [TEXT] Строка
- Активность: [V]
- Сортировка: 1001
- Группа свойств: Данные для доставки
- Свойство доступно в фильтре по заказам: [V]  

2.3.2)
- Название: [Маршрут] КЛАДР
- Мнемонический код: route_kladr
- Тип: [TEXT] Строка
- Активность: [V]
- Сортировка: 1002
- Группа свойств: Данные для доставки
- Свойство доступно в фильтре по заказам: [V]
  
2.3.3)
- Название: [Маршрут] Местоположение
- Мнемонический код: route_place
- Тип: [TEXT] Строка
- Активность: [V]
- Сортировка: 1003
- Группа свойств: Данные для доставки
- Свойство доступно в фильтре по заказам: [V]

__Примечание:__   
У всех полей сортировка может быть любой, но по возрастанию в следующем порядке: [Маршрут] Стоимость доставки, [Маршрут] КЛАДР, [Маршрут] Местоположение

2.4)	Измените поля:

2.4.1)	Местоположение - Значение по умолчанию: 548

2.4.2)	Адрес доставки - Значение по умолчанию: <добавить пробел>

# 3) Настройка службы доставки

3.1)	В разделе Администрирование откройте: [Магазин] -> [Настройки] -> [Службы доставки] -> [Автоматизированные]

3.2)	Нажмите на <редактировать> в списке с SID: Route

3.3)	Во вкладке [Базовая конфигурация] заполните поле Активен: [V]

3.4)	Перейдите на вкладку [Параметры Виджета]

3.5)	Заполните поле <Публичный ключ>	

